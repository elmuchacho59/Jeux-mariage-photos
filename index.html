<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mission Photo - Mariage</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3E%F0%9F%92%93%3C/text%3E%3C/svg%3E" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main class="app">
      <header class="app__header">
        <div class="brand">
          <h1>Hello, BINGO!</h1>
          <p class="subtitle">S√©lectionne tes missions et partage tes photos üéâ</p>
        </div>
        <div class="header-actions">
          <div class="theme-switcher">
            <label for="theme-toggle" class="sr-only">Mode Nuit</label>
            <input type="checkbox" id="theme-toggle" class="theme-toggle__input">
            <div class="theme-toggle__slider"></div>
          </div>
          <button id="go-gallery-btn" class="btn">Galerie</button>
          <button id="go-admin-btn" class="btn">Espace Admin</button>
        </div>
      </header>

      <section class="guest-flow" id="guest-flow-section">
        <!-- Step 1: Welcome -->
        <div class="guest-flow__step active" id="step-welcome">
            <div class="card intro">
                <div class="intro__content">
                    <h2>Hello, BINGO! ‚ú®</h2>
                    <p class="subtitle">Entre ton pr√©nom et c'est parti !</p>
                    <div id="access-banner" class="alert hidden">Acc√®s r√©serv√© aux invit√©s. Entrez votre nom tel que list√©, et le mot de passe si requis.</div>
                    <div class="intro__form">
                        <label for="invite-name" class="sr-only">Nom de l'invit√©</label>
                        <input id="invite-name" class="input input-lg" type="text" placeholder="Ton pr√©nom (ex: L√©a)" list="invite-names" />
                        <button id="start-btn" class="btn primary btn-lg">Commencer</button>
                    </div>
                    <datalist id="invite-names"></datalist>
                    <div class="intro__form intro__form--pass hidden" id="event-pass-row">
                        <input id="event-pass" class="input input-lg" type="text" placeholder="Mot de passe √©v√®nement" />
                        <button id="event-pass-help" class="btn" type="button" title="Aide mot de passe">?</button>
                        <button id="event-pass-toggle" class="btn" type="button" aria-pressed="true" title="Masquer/Afficher">üëÅ</button>
                    </div>
                    <div class="intro__form intro__form--pass hidden" id="invite-pass-row">
                        <input id="invite-pass" class="input input-lg" type="text" placeholder="Mot de passe (JJ/MM/AAAA)" />
                        <button id="invite-pass-help" class="btn" type="button" title="Aide mot de passe">?</button>
                        <button id="invite-pass-toggle" class="btn" type="button" aria-pressed="true" title="Masquer/Afficher">üëÅ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Missions & Upload -->
        <div class="guest-flow__step" id="step-missions">
            <div class="card">
                <div class="invite-header">
                    <div>
                        <div class="invite-name" id="current-invite">Invit√©</div>
                        <div class="invite-progress"><span id="assigned-count">0</span>/2 missions assign√©es</div>
                    </div>
                    <div class="actions">
                        <button id="next-invite-btn" class="btn">Changer d'invit√©</button>
                    </div>
                </div>

                <div id="mission-selection-panel">
                    <div class="card card--light" style="margin-bottom:8px;">
                        <h3>Choisir mes missions</h3>
                        <div class="row" style="gap:8px;">
                            <select id="mission1" class="input" title="Mission 1"></select>
                            <select id="mission2" class="input" title="Mission 2"></select>
                            <button id="mission-confirm-btn" class="btn primary">Valider</button>
                            <button id="mission-reset-btn" class="btn">R√©initialiser</button>
                        </div>
                        <div class="helper">S√©lectionnez les num√©ros (1 √† 10) pr√©sents sur votre carte papier.</div>
                    </div>
                </div>

                <div id="mission-display-panel" class="hidden">
                    <div id="mission-consignes" class="card card--light">
                        <h3>Mes missions</h3>
                        <ul id="mission-consignes-list" class="assigned__items"></ul>
                    </div>

                    <section class="card card--light upload" id="upload-section">
                        <h3>T√©l√©verse tes 2 photos</h3>
                        <p class="helper">Les photos sont compress√©es et restent sur cet appareil.</p>
                        <div class="upload__grid">
                            <div class="drop" data-slot="0">
                                <div class="drop__label" id="slot0-label">Mission 1</div>
                                <div class="drop__zone" id="slot0-zone">
                                    <input type="file" id="slot0-input" accept="image/*;capture=camera" capture="environment" class="drop__input" />
                                    
                                    <div class="drop__hint">Glisse une image ou clique</div>
                                    <img id="slot0-preview" class="drop__preview hidden" alt="Pr√©visualisation photo 1" />
                                </div>
                                <div class="drop__actions">
                                    <button id="slot0-live-btn" class="btn primary">Prendre une photo</button>
                                    <button id="slot0-gallery-btn" class="btn">Choisir une photo</button>
                                    <button id="slot0-clear" class="btn">Effacer</button>
                                </div>
                            </div>
                            <div class="drop" data-slot="1">
                                <div class="drop__label" id="slot1-label">Mission 2</div>
                                <div class="drop__zone" id="slot1-zone">
                                    <input type="file" id="slot1-input" accept="image/*;capture=camera" capture="environment" class="drop__input" />
                                    
                                    <div class="drop__hint">Glisse une image ou clique</div>
                                    <img id="slot1-preview" class="drop__preview hidden" alt="Pr√©visualisation photo 2" />
                                </div>
                                <div class="drop__actions">
                                    <button id="slot1-live-btn" class="btn primary">Prendre une photo</button>
                                    <button id="slot1-gallery-btn" class="btn">Choisir une photo</button>
                                    <button id="slot1-clear" class="btn">Effacer</button>
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin-top:8px; justify-content:flex-end; gap:8px;">
                            <button id="submit-missions-btn" class="btn primary" disabled>Envoyer</button>
                        </div>
                        <div id="submission-msg" class="helper hidden">Missions envoy√©es üéâ Tu es au top !</div>
                    </section>
                </div>
            </div>
        </div>

        <!-- Step 3: Confirmation -->
        <div class="guest-flow__step" id="step-confirmation">
            <div class="card intro">
                <div class="intro__content">
                    <h2>Merci pour ta participation ! ‚ú®</h2>
                    <p class="subtitle">Retrouve les photos prises dans la galerie une fois que le ma√Ætre du jeu aura valid√© ton d√©fi.</p>
                    <div class="row" style="justify-content:center;">
                        <button id="confirmation-gallery-btn" class="btn primary">Voir la galerie</button>
                        <button id="confirmation-new-guest-btn" class="btn">Nouvel invit√©</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

      <section class="card hidden" id="admin-section">
        <div class="admin-header">
          <h2>Espace Admin</h2>
          <div class="actions">
            <button id="admin-refresh" class="btn">Rafra√Æchir</button>
            <button id="admin-copy" class="btn">Copier</button>
            <button id="admin-export" class="btn">Exporter CSV</button>
            <button id="admin-export-zip" class="btn">Exporter ZIP</button>
            <button id="admin-logout" class="btn danger">D√©connexion</button>
            <button id="admin-exit" class="btn primary">Retour</button>
          </div>
        </div>

        <div class="card card--light stats-grid">
          <div class="stat-card">
            <h4>Participants</h4>
            <div id="stats-participants" class="stat-value">0</div>
          </div>
          <div class="stat-card">
            <h4>Photos en attente</h4>
            <div id="stats-pending" class="stat-value">0</div>
          </div>
          <div class="stat-card">
            <h4>Photos publi√©es</h4>
            <div id="stats-published" class="stat-value">0</div>
          </div>
        </div>

        <div class="card card--light" style="margin-bottom:12px;">
          <h3>Acc√®s invit√©s</h3>
          <div class="row" style="align-items:center; gap:12px;">
            <label class="helper">Qui peut acc√©der ?</label>
            <select id="access-mode" class="input input-sm">
              <option value="all">Tous (acc√®s ouvert)</option>
              <option value="guests_only">R√©serv√© aux invit√©s list√©s</option>
            </select>
          </div>
        </div>
        <div class="card card--light" style="margin-bottom:12px;">
          <h3>Acc√®s √©v√®nement</h3>
          <div class="row" style="align-items:center; gap:8px;">
            <label class="helper">Mot de passe obligatoire ?</label>
            <select id="event-required" class="input input-sm">
              <option value="no">Non</option>
              <option value="yes">Oui</option>
            </select>
            <input id="event-pass-admin" class="input" placeholder="Mot de passe √©v√®nement" />
            <button id="event-pass-save" class="btn primary">Enregistrer</button>
            <button id="admin-reset-settings" class="btn danger" title="R√©initialiser les param√®tres par d√©faut">R√©initialiser param√®tres</button>
          </div>
          <div class="helper">Conseil: utilisez un mot simple √† communiquer aux invit√©s (ex: un code li√© au mariage).</div>
        </div>
        <div class="card card--light" style="margin-bottom:12px;">
          <h3>Missions (1‚Äì10)</h3>
          <div class="missions-grid">
            <table class="table">
              <thead>
                <tr>
                  <th>N¬∞</th>
                  <th>Consigne</th>
                </tr>
              </thead>
              <tbody id="missions-tbody"></tbody>
            </table>
            <div class="helper">Ces consignes seront propos√©es aux invit√©s selon le num√©ro de mission choisi.</div>
          </div>
          <div class="actions" style="margin-top:8px;">
            <button id="missions-save" class="btn primary">Enregistrer les missions</button>
          </div>
        </div>
        <div class="card card--light" style="margin-bottom:12px;">
          <h3>Invit√©s</h3>
          <div class="row" style="margin-bottom:8px;">
            <input id="admin-guest-name" class="input" placeholder="Nom de l'invit√©" />
            <input id="admin-guest-pass" class="input" placeholder="Mot de passe (optionnel)" />
            <button id="admin-guest-add" class="btn primary">Ajouter</button>
          </div>
          <table class="table">
            <thead>
              <tr>
                <th>Invit√©</th>
                <th>Mot de passe</th>
                <th>Statut</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="admin-guests-tbody"></tbody>
          </table>
        </div>
        <div class="admin-tools">
          <input id="admin-search" class="input" placeholder="Rechercher un invit√©‚Ä¶" />
        </div>
        <div class="card card--light" style="margin-top:12px;">
          <h3>Photos (workflow)</h3>
          <div class="tabs">
            <button id="admin-tab-pending" class="tab active">En attente</button>
            <button id="admin-tab-approved" class="tab">Valid√©es</button>
            <button id="admin-tab-published" class="tab">Publi√©es</button>
          </div>
          <div class="row" style="margin-bottom:8px;">
            <label class="helper">Trier par</label>
            <select id="admin-photo-sort" class="input input-sm">
              <option value="date_desc">Plus r√©cent d'abord</option>
              <option value="date_asc">Plus ancien d'abord</option>
              <option value="likes_desc">Plus de likes (publi√©es)</option>
            </select>
            <button id="admin-delete-all-photos" class="btn danger" style="margin-left:auto;">Supprimer toutes les photos</button>
          </div>
          <div id="admin-photos-pending">
            <table class="table">
              <thead>
                <tr>
                  <th>Miniature</th>
                  <th>Invit√©</th>
                  <th>Mission</th>
                  <th>Envoy√©e</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="admin-photos-pending-tbody"></tbody>
            </table>
          </div>
          <div id="admin-photos-approved" class="hidden">
            <table class="table">
              <thead>
                <tr>
                  <th>Miniature</th>
                  <th>Invit√©</th>
                  <th>Mission</th>
                  <th>Valid√©e</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="admin-photos-approved-tbody"></tbody>
            </table>
          </div>
          <div id="admin-photos-published" class="hidden">
            <table class="table">
              <thead>
                <tr>
                  <th>Miniature</th>
                  <th>Invit√©</th>
                  <th>Mission</th>
                  <th>Publi√©e</th>
                  <th>Likes</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="admin-photos-published-tbody"></tbody>
            </table>
          </div>
        </div>
        <div class="actions" style="margin-top:8px;">
          <button id="admin-reset-all" class="btn danger" title="Effacer toutes les donn√©es locales">R√©initialiser tout</button>
        </div>
        <div class="card card--light" style="margin-top:12px;">
          <h3>Classement (temps de r√©alisation)</h3>
          <table class="table">
            <thead>
              <tr>
                <th>#</th>
                <th>Invit√©</th>
                <th>Temps</th>
              </tr>
            </thead>
            <tbody id="ranking-tbody"></tbody>
          </table>
        </div>
      </section>

      <section class="card hidden" id="gallery-section">
        <div class="admin-header">
          <h2>Galerie</h2>
          <div class="actions">
            <button id="gallery-exit" class="btn primary">Retour</button>
          </div>
        </div>
        <div id="gallery-columns" class="gallery-columns" style="margin-bottom:12px;"></div>
        
      </section>

      <div id="lightbox" class="lightbox hidden" aria-modal="true" role="dialog">
        <div class="lightbox__backdrop" id="lightbox-backdrop"></div>
        <div class="lightbox__content" role="document">
          <img id="lightbox-img" class="lightbox__img" alt="Agrandissement" />
          <div id="lightbox-caption" class="lightbox__caption"></div>
          <div class="lightbox__actions">
            <a id="lightbox-download" class="btn primary" download>T√©l√©charger</a>
            <button id="lightbox-close" class="btn">Fermer</button>
          </div>
        </div>
      </div>

      <footer class="footer">
        
        <small>Fait avec amour ‚ù§Ô∏è par Christina et Vincent √† Paris</small>
      </footer>
    </main>

    <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>
    <canvas id="confetti-canvas" class="confetti" width="0" height="0" aria-hidden="true"></canvas>

    <div id="loading-overlay" class="loading-overlay hidden">
      <div class="spinner"></div>
    </div>

    <script src="./app.js" type="module"></script>
  </body>
</html>
